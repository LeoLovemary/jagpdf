# -*- mode: sh -*-

# Copyright (c) 2005-2009 Jaroslav Gresula
# 
# Distributed under the MIT license (See accompanying file
# LICENSE.txt or copy at http://jagpdf.org/LICENSE.txt)
#


# java
echo ----- Testing Java 1.4.2 ------
do_test \
    jagpdf-$CFG_VERSION.$CFG_PLATFORM.java \
    -DCMAKE_PREFIX_PATH=/home/jarda/src/java/j2sdk1.4.2_18/

echo ----- Testing Java 1.5.0 ------
do_test \
    jagpdf-$CFG_VERSION.$CFG_PLATFORM.java \
    -DCMAKE_PREFIX_PATH=/home/jarda/src/java/jdk1.5.0_16/

echo ----- Testing Java 1.6.0 ------
do_test \
    jagpdf-$CFG_VERSION.$CFG_PLATFORM.java \
    -DCMAKE_PREFIX_PATH=/home/jarda/src/java/jdk1.6.0_12/


#python
echo ----- Testing Python 2.5 ------
do_test \
    jagpdf-$CFG_VERSION.$CFG_PLATFORM.py25 \
    -DPYTHON_EXECUTABLE=/usr/local/python/2.5.2/bin/python

echo ----- Testing Python 2.6 ------
do_test \
    jagpdf-$CFG_VERSION.$CFG_PLATFORM.py26 \
    -DPYTHON_EXECUTABLE=/usr/local/python/2.6.0/bin/python

echo ----- Testing Python 2.4 ------
do_test \
    jagpdf-$CFG_VERSION.$CFG_PLATFORM.py24 \
    -DPYTHON_EXECUTABLE=/usr/local/python/2.4.5/bin/python


# C/C++
echo ----- Testing C/C++ with gcc 4.1.2 ------
do_test \
    jagpdf-$CFG_VERSION.$CFG_PLATFORM.c_cpp \
    -DCMAKE_CXX_COMPILER=/usr/local/gcc/4.1.2/bin/g++ \
    -DCMAKE_C_COMPILER=/usr/local/gcc/4.1.2/bin/gcc \

echo ----- Testing C/C++ with gcc 4.2.4 ------
do_test \
    jagpdf-$CFG_VERSION.$CFG_PLATFORM.c_cpp \
    -DCMAKE_CXX_COMPILER=/usr/local/gcc/4.2.4/bin/g++ \
    -DCMAKE_C_COMPILER=/usr/local/gcc/4.2.4/bin/gcc \

#
# build from source
# 
JAGPDF_SOURCE_DIR=jagpdf-$CFG_VERSION
JAGPDF_BUILD_DIR=`cd $JAGPDF_SOURCE_DIR && pwd`.build
JAGPDF_DIST_DIR=$JAGPDF_BUILD_DIR/distribution

function install_from_source()
{
    echo "----- Install from source ($*) ------"
    cd $JAGPDF_BUILD_DIR
    #find . ! -regex '^./code.*' -delete
    rm -rf distribution/ gcccache/ CMakeCache.txt
    cmake \
        -DCMAKE_INSTALL_PREFIX=$JAGPDF_DIST_DIR \
        -DPYTHON_INSTALL_DIR=$JAGPDF_DIST_DIR/lib \
        $* \
        ../$JAGPDF_SOURCE_DIR
    make
    make unit-tests
    make apitests
    make install
    cd -

    echo ----- Testing installed binaries -----
    do_test $JAGPDF_DIST_DIR
}

mkdir -p $JAGPDF_BUILD_DIR
install_from_source
install_from_source -DJAG_WITH_PYTHON=OFF
install_from_source -DJAG_WITH_SWIG=OFF
install_from_source -DJAG_WITH_GCCXML=OFF



